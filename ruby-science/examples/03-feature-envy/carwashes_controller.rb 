class CarwashesController < ApplicationController
  def summary
    code = params[:code]
    ticket = fetch_ticket

    if ticket.confirmed_by?(code)
      ticket.update(status: Ticket::NEW)

      redirect_to summary_carwash_path
    else
      redirect_to confirm_step_carwash_path, alert: "Код подтверждения неправильный"
    end
  end

  private

  def fetch_ticket
    userdata = session[:userdata]
    Ticket.find(userdata[:ticket_id])
  end
end
